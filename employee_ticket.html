<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Employee Ticket</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="css/nav.css">
    <link rel="stylesheet" href="css/table.css">
    <link rel="stylesheet" href="css/image.css">
</head>

<style>
    .input-bottom-border {
        display: none;
    }

    #cancel {
        display: none;
    }



    .dropdown {
        position: relative;
        width: 100%;
    }

    .dropdown button {
        width: 90%;
        padding: 10px;
        font-size: 1em;
        color: #9e9e9e;
        background-color: transparent;
        border: none;
        border-bottom: 1px solid #ccc;
        border-radius: 4px;
        text-align: left;
        cursor: pointer;
    }

    .dropdown button::after {
        content: "â–¼";
        float: right;
        font-size: 0.8em;
    }

    .dropdown-options {
        display: none;
        position: absolute;
        width: 100%;
        overflow-y: auto;
        border: 1px solid#9e9e9e;
        border-radius: 4px;
        margin-top: 5px;
        z-index: 10;
        background-color: #9e9e9e;
    }

    .dropdown-options label {
        display: flex;
        align-items: center;
        padding: 8px;
        font-size: 1em;
        color: white !important;
        cursor: pointer;

    }

    .dropdown-options input[type="checkbox"] {
        margin-right: 8px;
        cursor: pointer;
    }

    @media (max-width:840px) {

        #addEmployee,
        #addEmployee2 {
            font-size: 12px;
        }
    }

    @media (max-width:450px) {
        .card {
            width: 100% !important;
        }
    }


    @media (min-width:350px) and (max-width:767px) {

        #buttons {
            gap: 10px;
        }

        .col-md-4.pt-3 {
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        #addEmployee,
        #addEmployee2 {
            float: right;
        }

        #cancel,
        #addEmployee,
        #addEmployee2 {
            width: 48%;
            margin-bottom: 0;
            font-size: 13px;
        }

        .input-bottom-border {
            font-size: 13px;

        }
    }



    @media (max-width: 350px) {

        #addEmployee,
        #cancel,
        #addEmployee2 {
            width: 49%;
            margin-bottom: 10px;
            font-size: 10px;
        }

        #addEmployee,
        #addEmployee2 {
            float: right;
        }

        .input-bottom-border {
            font-size: 10px;

        }

        .col-md-4.pt-3 {
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        #buttons {
            gap: 10px;
        }
    }

    @media (min-width: 280px) and (max-width: 318px) {

        #addEmployee,
        #cancel,
        #addEmployee2 {
            width: 47%;
            margin-bottom: 10px;
            font-size: 8px;
            border-radius: 5px;
        }

        .input-bottom-border {
            font-size: 8px;

        }
    }

    @media (max-width:1060px) {

        #addEmployee,
        #addEmployee2,
        #cancel {

            margin-bottom: 10px;
            font-size: 12px;
            border-radius: 5px;
        }
    }
</style>


<body>
    <div id="nav" class="mb-5">
        <div class="container d-flex justify-content-between align-items-center">
            <div class="col-4">
                <img src="icon/menu icon.png" alt="" class="sidebar-toggle img-fluid" id="sidebarToggle"
                    style="width: 20%;">
            </div>
            <div class="col-4 text-center">
                <img src="images/logo.png" alt="Logo" id="logo" style="max-width: 100%;">
            </div>
            <div class="col-4 text-end">
                <img src="icon/bell.png" alt="Profile Icon" id="icon">
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <div class="container">
                <div class="row">
                    <!-- Sidebar -->
                    <div class="col-sm-12 col-xl-2 col-md-2 col-lg-2 col-sty" id="left">
                        <!-- Sidebar -->
                        <div id="sidebar">
                            <div id="sidebar-header" class="m-3 mb-5">
                                <img src="images/logo.png" alt="Sidebar Logo" style="width: 100%;">
                            </div>
                            <div id="sidebar-content">
                                <div class="list-group list-group-flush">
                                    <a href="dashboard.html"
                                        class="list-group-item list-group-item-action bg-purple"><img
                                            src="icon/Mask group-2.png" style="width: 25px;margin-top: -5px;"><span
                                            style="padding-left: 10px;color: white;">Dashboard</span></a>
                                    <a class="list-group-item list-group-item-action bg-purple dropdown-toggle" href="#"
                                        id="ticketMenu" data-bs-toggle="collapse" data-bs-target="#ticketSubmenu"
                                        aria-expanded="false" aria-controls="ticketSubmenu">
                                        <img src="icon/Mask group-3.png" style="width: 25px;margin-top: -5px;">
                                        <span style="padding-left: 10px;color: white;">Ticket</span>
                                    </a>

                                    <div id="ticketSubmenu" class="collapse">
                                        <ul class="list-group list-group-flush" id="list-group-flush">
                                            <li class="list-group-item"><a href="Unassigned.html">Unassigned Tickets</a>
                                            </li>
                                            <li class="list-group-item"><a href="Inprocess.html"
                                                    class=" bg-purple">In-Progress</a></li>
                                            <li class="list-group-item"><a href="invoice.html"
                                                    class=" bg-purple">ReadyForInvoice</a></li>
                                            <li class="list-group-item"><a href="completed.html">Completed Ticket</a>
                                            </li>
                                            <li class="list-group-item"><a href="RejectedTicket.html">RejectedTicket</a>
                                            </li>
                                        </ul>
                                    </div>
                                    <a href="employee_ticket.html"
                                        class="list-group-item list-group-item-action bg-purple"><img
                                            src="icon/Mask group.png" style="width: 30px;margin-top: -5px;"><span
                                            style="padding-left: 10px;color: white;">Employees</span></a>
                                    <a href="home-profile.html"
                                        class="list-group-item list-group-item-action bg-purple"><img
                                            src="icon/Mask group-1.png" style="width: 30px;margin-top: -5px;"><span
                                            style="padding-left: 10px;color: white;">Profile</span></a>
                                    <div style="position: fixed; bottom: 0; display: inline-flex;cursor: pointer;"
                                        data-bs-toggle="modal" data-bs-target="#logoutModal" class="m-3">
                                        <img src="icon/Vector.png" id="icon">
                                        <span class="content text-white list-group-item">Logout</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Main Content -->
                    <div class="col-sm-12 col-xl-10 col-md-10 col-lg-10 col-sty" id="fix">
                        <p id="header"
                            style="box-shadow: 0px 10px 10px 0px rgba(0, 0, 0, 0.5); margin-left: -12px; padding: 20px; margin-right: -12px; font-weight: bold;">
                            Employee <span class="span">XYZ Company <img src="icon/Mask group (2).png" alt=""
                                    style="width: 40px; padding-left: 10px;"></span>
                        </p>

                        <div class="container container-sty">
                            <h1 class="text-center m-3 mt-5 fw-bold">Employee ticket</h1>

                            <div class="container-fluid center-container">
                                <div class="row">
                                    <div class="col-md-3 text-center">
                                        <input type="text" class="input-bottom-border mt-4" placeholder="First Name">
                                        <input type="text" class="input-bottom-border mt-4" placeholder="Last Name">
                                    </div>
                                    <div class="col-md-3 text-center">
                                        <input type="text" class="input-bottom-border mt-4" placeholder="Email">
                                        <input type="text" class="input-bottom-border mt-4" placeholder="Phone Number">
                                    </div>
                                    <div class="col-md-3 text-center">
                                        <input type="text" class="input-bottom-border mt-4"
                                            placeholder="Assigned Location">
                                        <div class="dropdown">
                                            <button id="dropdownButton" class="input-bottom-border mt-4"
                                                onclick="toggleDropdown(event)">Specialization</button>
                                            <div class="dropdown-options input-bottom-border" id="dropdownOptions"
                                                onclick="event.stopPropagation()">
                                                <label><input type="checkbox" value="AC" onchange="updateButton(this)">
                                                    AC</label>
                                                <label><input type="checkbox" value="Fridge"
                                                        onchange="updateButton(this)"> Fridge</label>

                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-md-3 pt-3" id="buttons" style="float: right;">

                                        <button type="submit" class="mt-4 login-button" id="cancel"
                                            onclick="cancel()">Cancel</button>
                                        <button type="submit" class="mt-4 login-button" id="addEmployee"
                                            style="display: none;" id="addEmployee" onclick="createEmployee()">Add
                                            employee</button>
                                        <button type="submit" class="mt-4 login-button" id="addEmployee2"
                                            onclick="show()">Add employee</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Table -->
                            <div class="container-fluid mt-5   justify-content-center" id="card">
                                <div id="table" class="d-none d-md-table">
                                    <table id="ticketTable" class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <!-- <th></th> -->
                                                <th>Employee Name</th>
                                                <th>Phone</th>
                                                <th>Specialization</th>
                                                <th>Email</th>
                                                <th>Location</th>
                                                <th>Completed Work</th>
                                                <th>Pending Work</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tBody"></tbody>
                                    </table>
                                </div>

                                <div id="card-container" class="d-md-none d-block card-view"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="loading" id="l">
        <div class="spinner"></div>
    </div>



    <div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content custom-modal-content">
                <div class="modal-body custom-modal-body">
                    Are you sure you want to log out?
                </div>
                <div class="modal-footer custom-modal-footer">
                    <button type="button" class="btn-yes ">Yes</button>
                    <button type="button" class="btn-no " data-bs-dismiss="modal">No</button>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"></script>

    <script src="script/employee_ticket.js"></script>
    <script>

        const apiUrlBase = "https://m4j8v747jb.execute-api.us-west-2.amazonaws.com/dev/employee";
        const apiUrl = `${apiUrlBase}/create`;
        const cid = localStorage.getItem("cid");

        function createEmployee() {
            const firstName = document.querySelector("input[placeholder='First Name']").value;
            const lastName = document.querySelector("input[placeholder='Last Name']").value;
            const email = document.querySelector("input[placeholder='Email']").value;
            const phone = document.querySelector("input[placeholder='Phone Number']").value;
            const location = document.querySelector("input[placeholder='Assigned Location']").value;
            const specialization = Array.from(document.querySelectorAll("#dropdownOptions input[type='checkbox']:checked"))
                .map(option => option.value);

            // Input validation
            if (!firstName || !lastName || !email || !phone || specialization.length === 0) {
                alert("Please fill in all required fields and select at least one specialization.");
                return;
            }

            const employeeObject = {
                first_name: firstName,
                last_name: lastName,
                email: email,
                phone_number: phone,
                specialization: specialization.join(", "),
                assigned_locations: location,
                company_id: cid
            };

            console.log("Employee Object:", employeeObject);

            fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(employeeObject)
            })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(errorData => {
                            console.error('Server Response:', errorData);
                            throw new Error(`Server Error: ${errorData.message || response.status}`);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    alert('Employee created successfully!');

                    // Clear input fields
                    const firstNameInput = document.getElementById("firstName");
                    const lastNameInput = document.getElementById("lastName");
                    const emailInput = document.getElementById("email");
                    const phoneInput = document.getElementById("phone");
                    const locationInput = document.getElementById("location");
                    const dropdownButton = document.getElementById("dropdownButton");

                    if (firstNameInput) firstNameInput.value = '';
                    if (lastNameInput) lastNameInput.value = '';
                    if (emailInput) emailInput.value = '';
                    if (phoneInput) phoneInput.value = '';
                    if (locationInput) locationInput.value = '';

                    // Reset specialization checkboxes
                    document.querySelectorAll("#dropdownOptions input[type='checkbox']").forEach(checkbox => checkbox.checked = false);
                })
                .catch(error => {
                    console.error('Error:', error.message);
                    alert(`Error: ${error.message}`);
                });
        }
        // Function to add employee to the table
        function addEmployeeToTable(employee) {
            const tbody = document.getElementById("tBody");
            const newRow = document.createElement("tr");

            newRow.innerHTML = `
                <td>${employee.firstName} ${employee.lastName}</td>
                <td>${employee.phone}</td>
                <td>${employee.specialization}</td>
                <td>${employee.email}</td>
                <td>${employee.location || "Location TBD"}</td>
                <td>${employee.completedWork || 0}</td>
                <td>${employee.pendingWork || 0}</td>
            `;

            tbody.appendChild(newRow);
        }

        // Reset form function
        function resetForm() {
            document.querySelector("input[placeholder='First Name']").value = "";
            document.querySelector("input[placeholder='Last Name']").value = "";
            document.querySelector("input[placeholder='Email']").value = "";
            document.querySelector("input[placeholder='Phone Number']").value = "";
            document.getElementById("dropdownButton").textContent = "Specialization";

            cancel(); // Hide the input fields
        }

        // Event listener for the "Add Employee" button
        document.getElementById("addEmployee").addEventListener("click", function (event) {
            event.preventDefault();
            createEmployee();
        });

        function show() {
            const inputElements = document.querySelectorAll(".input-bottom-border");

            // Loop through each element and set the display style to "inline"
            inputElements.forEach(element => {
                element.style.display = "inline";
            });
            document.getElementById("cancel").style.display = "inline";
            document.getElementById("addEmployee2").style.display = "none";
            document.getElementById("addEmployee").style.display = "inline";
        }

        // Hide the input fields when "Cancel" button is clicked
        function cancel() {
            const inputElements = document.querySelectorAll(".input-bottom-border");

            // Loop through each element and set the display style to "none"
            inputElements.forEach(element => {
                element.style.display = "none";
            });
            document.getElementById("cancel").style.display = "none";
            document.getElementById("addEmployee2").style.display = "inline";
            document.getElementById("addEmployee").style.display = "none";
        }
    </script>


    <script>
        const MAX_SELECTION = 3;

        function toggleDropdown(event) {
            const dropdownOptions = document.getElementById("dropdownOptions");
            dropdownOptions.style.display = dropdownOptions.style.display === "block" ? "none" : "block";
            event.stopPropagation();
        }

        function updateButton(checkbox) {
            const checkboxes = document.querySelectorAll("#dropdownOptions input[type='checkbox']");
            const selectedOptions = Array.from(checkboxes).filter(checkbox => checkbox.checked);

            // Limit selection to MAX_SELECTION
            if (selectedOptions.length > MAX_SELECTION) {
                checkbox.checked = false;
                alert(`You can select up to ${MAX_SELECTION} options only.`);
                return;
            }

            const selectedValues = selectedOptions.map(option => option.value);
            const dropdownButton = document.getElementById("dropdownButton");
            dropdownButton.textContent = selectedValues.length > 0
                ? selectedValues.join(", ")
                : "Select your favorite fruits";
        }

        // Close the dropdown if the user clicks outside of it
        window.onclick = function () {
            const dropdownOptions = document.getElementById("dropdownOptions");
            dropdownOptions.style.display = "none";
        };
    </script>
</body>

</html>