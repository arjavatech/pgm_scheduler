<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Company</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- DataTables CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="css/company.css" />
    <link rel="stylesheet" href="css/image.css" />
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="container">
          <div class="row">
            <!-- Sidebar -->
            <div class="col-sm-12 col-xl-2 col-md-2 col-lg-2 col-sty" id="left">
              <div id="sidebar">
                <div id="sidebar-header" class="m-3 mb-4 mt-5">
                  <img
                    src="images/logo.png"
                    alt="Sidebar Logo"
                    style="width: 80%"
                  />
                </div>
                <div id="sidebar-content">
                  <div class="list-group list-group-flush">
                    <a
                      href="#"
                      class="list-group-item list-group-item-action bg-purple"
                      ><span style="padding-left: 10px; color: white"
                        >Dashboard</span
                      ></a
                    >

                    <a
                      href="#"
                      class="list-group-item list-group-item-action bg-purple"
                      ><span style="padding-left: 10px; color: white"
                        >Register</span
                      ></a
                    >
                    <a
                      href="#"
                      class="list-group-item list-group-item-action bg-purple"
                      ><span style="padding-left: 10px; color: white"
                        >Companies</span
                      ></a
                    >
                    <div
                      style="position: fixed; bottom: 0; display: inline-flex"
                      class="m-3"
                    >
                      <img src="icon/Vector.png" id="icon" />
                      <span class="content text-white list-group-item"
                        >Logout</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Main Content -->
            <div
              class="col-sm-12 col-xl-10 col-md-10 col-lg-10 col-sty"
              id="fix"
            >
              <div class="container container-sty">
                <h1 class="text-center m-3 mt-5 fw-bold">Company</h1>

                <!-- Table -->
                <div
                  class="container-fluid mt-5 d-flex justify-content-center"
                  id="table"
                >
                  <table id="ticketTable" class="table">
                    <thead>
                      <tr>
                        <th>Company Id</th>
                        <th>Company Name</th>
                        <th id="fws">Phone Number</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Email</th>
                      </tr>
                    </thead>
                    <tbody id="tBody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"></script>

    <script>
                   document.addEventListener('DOMContentLoaded', viewcompanydetails);
                   function viewcompanydetails() {
          const tableBody = document.getElementById("tBody");
          const apiUrl = `https://m4j8v747jb.execute-api.us-west-2.amazonaws.com/dev/company/getall`;

          fetch(apiUrl)
              .then(response => {
                  if (!response.ok) {
                      throw new Error(`Error: ${response.status}`);
                  }
                  return response.json();
              })
              .then(data => {
                  // Store the fetched data
                  employeesData = data;

                  // Clear any existing DataTables instance
                  if ($.fn.DataTable.isDataTable('#employeeTable')) {
                      $('#employeeTable').DataTable().clear().destroy();
                  }

                  // Clear the existing table body content
                  tableBody.innerHTML = '';
                  let index = 1;
                  // Populate the table body with fetched data
                  employeesData.forEach(element => {

                      const newRow = document.createElement('tr');
                      newRow.innerHTML = `
                      <td>${index++}</td>
                          <td class="pin-column">${element.company_name}</td>
                          <td class="name-column">${element.phone_number}</td>
                          <td class="phone-column">${element.first_name}</td>
                          <td class="isAdmin">${element.last_name}</td>
      			<td class="isAdmin">${element.email}</td>

                      `;
                      tableBody.appendChild(newRow);


                  });


              })
              .catch(error => {
                  console.error('Fetch error:', error);
                  document.getElementById('overlay').style.display = 'none';
              });
      }
    </script>
  </body>
</html>
